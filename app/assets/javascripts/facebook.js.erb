jQuery(function() {
  // load fb sdk async
  $("body").prepend('<div id="fb-root"></div>');
  return $.ajax({
    url: "" + window.location.protocol + "//connect.facebook.net/en_US/all.js",
    dataType: 'script',
    cache: true
  });
});

window.fbAsyncInit = function() {
  FB.init({
    appId: '<%= FACEBOOK_CONFIG["app_id"] %>',
    channelUrl: '//' + window.location.host + '/channel.html',
    status: true,
    cookie: true,
    xfbml: true
  });

  // var testApi = function() {
  //   // get friends
  //   console.log("looking up friends");
  //   FB.api('/me/friends?fields=id,name,picture', function(response) {
  //     console.log(response);
  //   });
  // };

  // FB.getLoginStatus(function(response) {
  //   if (response.status === 'connected') {
  //     // connected
  //   } else if (response.status === 'not_authorized') {
  //     // not_authorized
  //   } else {
  //     // not_logged_in
  //   }
  // });

  var session = new Mamajamas.Models.LoginSession();
  var postSignup = new Mamajamas.Views.PostSignup({
    model: session,
    el: '#post-signup-modal'
  });

  $("#create-account, #login-window").on("click", "#bt-fb-connect, #bt-fb-connect-s", (function(e) {
    e.preventDefault();
    session.login('<%= FACEBOOK_CONFIG["scope"] %>' );
  }));

  return $("#logout").click(function(e) {
    session.logout();
    return true;
  });
};
